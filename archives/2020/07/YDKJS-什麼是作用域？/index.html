<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>【 YDKJS 】什麼是 Scope？ · Ruru-Front-End-Blog</title><meta name="description" content="Scope 提供查找、儲存變數的一組規則，編譯器、引擎都會使用這組規則，在編譯器經歷詞法分析、解析後，便會將解析成抽象語法樹的 AST 轉化成機器代碼"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="../../../../favicons.jpg"><link rel="stylesheet" href="../../../../css/hermes.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/YUN-RU-TSENG/atom.xml" title="Ruru-Front-End-Blog"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="atom.xml" title="Ruru-Front-End-Blog" type="application/atom+xml"></head><body><div class="wrap"><header><a class="logo-link" href="../../../../index.html"><img src="../../../../favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="../../../../index.html" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="../../../../https:/github.com/YUN-RU-TSENG" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="../../../" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="../../../../https:/mail.google.com/mail/u/0/#inbox?compose=CllgCJTJnslxNqjBDkxGtdSVcGzcSZCczzVSQlprTXfFvBvLQZcwtWnCKxDchvrXJXKtWlzJLtL" target="_blank">FEED</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">【 YDKJS 】什麼是 Scope？</h1><div class="post-info">Jul 6, 2020</div><div class="post-content"><blockquote><p>資料來源：<a href="https://github.com/getify/You-Dont-Know-JS/tree/1ed-zh-CN">YDKJS 作用域與閉包 - 第一章</a></p></blockquote><h4 id="本篇提及："><a href="#本篇提及：" class="headerlink" title="本篇提及："></a>本篇提及：</h4><ul><li>scope</li><li>編譯器</li><li>引擎</li><li>RHS、LHS</li></ul><p>Scope 提供查找、儲存變數的一組規則，編譯器、引擎都會使用這組規則，在編譯器經歷詞法分析、解析後，便會將解析成抽象語法樹的 AST 轉化成機器代碼：</p><a id="more"></a><p>可以使用 node.js 查看 bytecode</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node --print-bytecode ooxxoo.js</span><br></pre></td></tr></table></figure><h2 id="以實例查看-scope-與編譯器、引擎的互動"><a href="#以實例查看-scope-與編譯器、引擎的互動" class="headerlink" title="以實例查看 scope 與編譯器、引擎的互動"></a>以實例查看 scope 與編譯器、引擎的互動</h2><blockquote><p>以 <code>var S = 12</code> 為範例：</p></blockquote><p>在編譯器經歷詞法分析、解析後，在編譯上述代碼成機器碼時，會進行以下的動作：</p><ol><li>查看 <code>var S</code> 是否已存在當前 scope集合中，若是有則忽略該聲明；若是無則會讓 scope 在該 scope 集合中新增 <code>S</code> 變數。</li><li>編譯器生成 <code>S = 12</code> 的機器碼，以提供引擎稍後執行賦值的動作。引擎在執行該程式碼時，也會詢問 scope 中是否存在此變數</li></ol><h4 id="引擎詢問-scope-分為-LHS、-RHS"><a href="#引擎詢問-scope-分為-LHS、-RHS" class="headerlink" title="引擎詢問 scope 分為 LHS、 RHS"></a>引擎詢問 scope 分為 <code>LHS</code>、 <code>RHS</code></h4><p><code>LHS</code> 變數在左側，查詢是否存在，並且執行賦值操作。（不一定在左測，想成賦予數值的目標）</p><ul><li>當找尋不到時，且並非 <code>strict</code> 模式，會在全域中新增該變數。</li><li>當找尋不到時，且為 <code>strict</code> 模式，會拋出 <code>ReferenceError</code></li></ul><p><code>RHS</code> 變數在右側，查詢是否存在，並且返回其值。（不一定在右側，想成查找數值的源頭）</p><ul><li>當找尋不到時，會丟出 <code>ReferenceError</code></li><li>當找到但卻拿著該數值做不正確的行為（如拿基本型別去跑函式）則會丟出 <code>TypeError</code></li></ul><p><code>RHS</code></p><p>以下會發現變數 <code>a</code> 在右側，經過查詢得到其數值後便會被返回。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a)</span><br></pre></td></tr></table></figure><p><code>LHS</code></p><p>會查找該變數存在與否，並賦予新值。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="number">22</span></span><br></pre></td></tr></table></figure><h5 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">foo</span> (<span class="params"> a </span>)  </span>&#123;</span><br><span class="line">	<span class="built_in">console</span> . log (  a  ) ;  <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo (  <span class="number">2</span>  ) ;</span><br></pre></td></tr></table></figure><p>scope 與引擎的交互：</p><ol><li><code>RHS</code> 查詢 foo 函式，並執行</li><li><code>LHS</code> 將 a 參數賦予數值 2</li><li><code>RHS</code> 查詢 console 是否存在</li><li><code>RHS</code> 查詢 a，並且 console 打印</li></ol><blockquote><p>注意：其中的 foo 函式並非 <code>var foo = function(){...}</code> 賦值的概念，此函數聲明一開始在編譯器生成時，就已經將函式賦予該變數。</p></blockquote><h2 id="巢狀-scope"><a href="#巢狀-scope" class="headerlink" title="巢狀 scope"></a>巢狀 scope</h2><p>就像程式碼被巢狀在另一堆程式碼中，作用域也是巢狀存在於其他作用域中的，如果該作用域找不到變數，引擎便會向外尋找。</p><p>像是 console 若在 foo 內找尋不著，便會向全域尋找。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">foo</span> (<span class="params"> a </span>)  </span>&#123;</span><br><span class="line">	<span class="built_in">console</span> . log (  a  ) ;  <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo (  <span class="number">2</span>  ) ;</span><br></pre></td></tr></table></figure><p>查找 console 時，若找到最頂層仍無（只是舉例，當然不會找不到），則會視是否有嚴格模式來決定是要給予錯誤或是將該變數新增到全域中。</p></div></article></div></main><footer><div class="paginator"><a class="next" href="../%E5%88%9D%E6%8E%A2-Internet-%E5%9F%BA%E7%A4%8E%EF%BC%9AIP%E3%80%81DNS%E3%80%81HTTP-request/">NEXT</a></div><div class="copyright"><p>© 2020 ruru-tseng, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/claymcleod/hexo-theme-hermes" target="_blank">hexo-theme-hermes</a>.</p><p>Logo made by <a href="https://www.flaticon.com/authors/freepik" target="_blank" rel="noopener">Freepik</a> from <a href="https://flaticon.com" target="_blank" rel="noopener">www.flaticon.com</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>